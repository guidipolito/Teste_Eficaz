<!DOCTYPE html>
<html lang="pt-BR">
	<head>
	<meta charset="UTF-8">
	<title>Eficaz</title>
	<link rel="stylesheet" href="css/bootstrap.css"> 
	<script src="js/jquery.js"></script>
	    <script src="js/bootstrap.bundle.min.js"></script>
	<link rel="stylesheet" href="css/main.css">
</head>
<body>
	<div class="container">
		<img src="imagem/eficaz_logo.png" alt="logo" id="iLogo"><br>
		<div class="row">
	   		<div class="col-md-3">
		   		<a href="cadastro.html"><div class="cadbutton">Cadastro</div></a>
				<a href="index.html"><div class="cadselected">Lista de cadastrados</div></a>
				<br>
	   		</div>
			<div class="col-md-9"> 
			   	<div class="teladireita">
					<div class="card">
						<div class="card-body">
							<h5 class="card-title">Lista de Cadastrados</h5>
							<div class="row">
								<div class="col-lg-12">
									<div class="table-responsive table-space">
										<table class="table table-hover" id="table-lista-cadastrados">
											<thead>
												<tr>
													<td>Nome</td>
													<td>E-mail</td>
													<td>Telefone</td>
													<td>Endereço</td>
													<td>Ação</td>
												</tr>
											</thead>
											<tbody>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
			   	</div>
	   		</div>
		</div>
	</div>
</body>
<script type="application/javascript">
function buscaUsuariosCadastrados(){
			$.ajax({
				url: "https://estagio.eficazmarketing.com/api/user",
				type: "GET",
				data: []
			}).done(function(result) {
				$.each(result, function(index, usuario){
					let idusuario = usuario.id;

					let tr = '<tr id="usuario_' + idusuario + '">';
					tr += '<td id="' + idusuario + '" data-nome="' + usuario.nome + '">' + usuario.nome + '</td>';

					tr += '<td id="' + idusuario + '" data-emal="' + usuario.email + '">' + usuario.email + '</td>';

					tr += '<td id="' + idusuario + '" data-telefone="' + usuario.telefone + '">' + usuario.telefone + '</td>';
					tr += '<td id="' + idusuario + '" data-end="' + usuario.cep+usuario.numero + '">' + usuario.rua + '<br>'+usuario.bairro+'<br>'+usuario.cep+'<br>'+usuario.cidade+'-'+usuario.uf+'</td>';

					tr += '<td style="width:10%">';

					tr += '<button type="button" class="btn btn-success btEditar" id="btEditar_' + idusuario + '" onclick="usuedit('+idusuario+')">Editar</button><br/>';

					tr += '<button type="button" class="btn btn-danger btExcluir" id="btExcluir_' + idusuario + '" onclick="usudelete('+idusuario+')">Excluir</button>';

					tr += '</td>';

					tr += '</tr>';

					$("#table-lista-cadastrados > tbody").append(tr);
					});
				});
			}

	$(document).ready(function(){
					buscaUsuariosCadastrados();
		});
	function usudelete(id){
		if(confirm("Deve-se prosseguir com exclusão do cadastro?")){
			$.ajax({
				url: 'https://estagio.eficazmarketing.com/api/user/'+id,
				type: 'DELETE',
				success: function(resposta){
					alert(resposta.message);
				}
			});
		}
	}
	function usuedit(id){
		window.sessionStorage.clear();
		window.sessionStorage.setItem("idEficaz",id);
		window.location.assign("cadastro.html");
	}
</script>
</html>
